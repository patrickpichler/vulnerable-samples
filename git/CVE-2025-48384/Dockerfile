# Dockerfile
FROM alpine:3.18

ARG TARGETARCH

LABEL maintainer="github.com/vinieger"
LABEL description="PoC image for CVE-2025-48384"

# Install vulnerable Git version
RUN ARCH=$(echo "${TARGETARCH}" | sed -e 's/arm64/aarch64/' -e 's/amd64/x86_64/'); \
  wget https://dl-cdn.alpinelinux.org/alpine/v3.18/main/$ARCH/git-2.40.4-r0.apk && \
    apk add --no-cache --allow-untrusted git-2.40.4-r0.apk && \
    rm -f git-2.40.4-r0.apk

# Clone and run exploit at container start
RUN git clone https://github.com/vinieger/CVE-2025-48384.git && \
    git clone https://github.com/liamg/CVE-2025-48384-submodule.git

COPY entrypoint.sh .

ENTRYPOINT [ "/entrypoint.sh" ]
